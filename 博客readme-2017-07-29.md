## 作者信息：
* 作者：李啸宇
* 日期：2016-10-31
* email：euewrqe@gmail.com
* GitHub：[https://github.com/euewrqe/MyBlog]
* python: 3.5.0
* django: 1.11.0
* version: 1.3

### document


本博客用nginx+uwsgi+django(v1.11)+python(v3.5)搭建

博客源文件下载：https://github.com/euewrqe/MyBlog


- python3 linux安装

``` python
'''
1,安装v3.0以上，建议安装v3.5
2,要安装pip3(python安装包自带)
3,安装几个模块
'''
几个模块
pymysql, django, uwsgi
```

- django配置部分

``` python
#setting.py

DEBUG=false
ALLOW_HOSTS=[]  #加入你的域名
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 数据库名,
        'USER': 用户,
        'PASSWORD': 密码,
        'HOST': 主机,
        'PORT': 端口,
    }
}
MARKDOWN_FILE_DIR = 'static/custom_doc'  #保存markdown文件的路径
#创建数据库
python manage.py makemigrations
python manage.py migrate
#创建超级用户
python manage.py createsuperuser

#之后搭建完nginx后，登陆/admin/  创建博客用户
#需要注意的是在创建用户密码时，先生成md5值传入，再确定
```

- uwsgi使用部分
uwsgi官网:https://uwsgi-docs.readthedocs.io/en/latest/

```
#uwsgi安装
wget https://projects.unbit.it/downloads/uwsgi-latest.tar.gz
tar zxvf uwsgi-latest.tar.gz
cd uwsgi-latest
python uwsgiconfig.py –build

#uwsgi基本使用
#写一个example.py
def application(env, start_response):
    start_response('200 OK', [('Content-Type','text/html')])
    return [b"Hello World"]

#启动uwsgi，就可以在页面上请求
uwsgi --plugins http,python --http-socket :8001 --wsgi-file a.py

--module和--wsgi-file
本质一样，--module 以python模块的方式查找，--wsgi-file以 文件的方式查找
在django中都变成查找wsgi文件
```

- uwsgi配置部分

```
#这些配置都能在uwsgi --help中找到
[uwsgi]
plugins= http,python     # 配置nginx必须填这个
socket = :8001         # 并非--http-socket
listen= 80
master= true
chdir = /var/html/django-blog/   # 博客根目录
wsgi-file = prod/wsgi.py   #wsgi的目录
processes = 4
threads = 2
# 安装uwsgi的python路径，用--python-version查看当前路径
pythonpath= /usr/local/python/lib/python3.5/site-packages
socket-timeout=10
daemonize = #log目录
#stats = :9191
```

- nginx配置部分

```
server {
        listen       80;
        server_name  域名;
            root   根目录;
        location / {
              include        uwsgi_params;
            uwsgi_pass  uwsgi开放的端口：如上面的127.0.0.1:8001;
        }
        location /static {
                alias 放置static静态文件的路径;
        }
access_log  nginx的log文件目录  main;
}

```

**url**

```
/admin/数据库管理
/backend/ 博客后台管理
/ 页面
```

### 优化项
1. 编辑时，设定自动保存，当不在有键盘输入事件时，开始倒计时，事件设定在settings中配置：EDIT_TIMEOUT    此项内容可以不跳转到列表
2. 当无意间转跳时，自动保存编辑内容
3. 当无意间关闭时，自动保存编辑内容
4. 浏览器每次到编辑页面都会去和数据库比对，然后放入markdown

### 项目目录结构

├── backend     后台相关文件
│   ├── migrations
│   └── templatetags
├── prod
├── repository   数据库相关文件
│   ├── migrations
├── static
│   ├── content
│   ├── css
│   ├── custom_doc
│   ├── custom_imgs
│   ├── imgs
│   └── js
├── templates
│   ├── backend
│   └── web
├── utils   工具类
└── web     前台相关文件

该项目的目的：
1，登陆注册
2，写博客，提交
3，前后台浏览博客
4，修改博客
5，浏览用户，修改用户
5，传文件，图片
5，修改图片




数据库结构
用户表，博客表
一个用户写多个博客，一对多
用户表
用户名，密码，邮箱，。。
博客表
博客标题，内容，日期，用户id



本博客使用editor.md(markdown)编辑器。提交博客时:提交标题，提交markdown，提交生成的html
后台自动在数据库生成，并在文件夹中生成markdown
MARKDOWN目录设置：settings中配置`MARKDOWN_FILE_DIR`


## 状态说明
200  OK
301
302  其他错误

前端可插拔模板


